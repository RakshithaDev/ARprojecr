<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Art AR + Comments (No Backend)</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    html,body{margin:0;height:100%;overflow:hidden;font-family:system-ui,-apple-system,Segoe UI,Roboto}
    #ui {
      position: fixed; left: 0; right: 0; bottom: 0;
      padding: 12px; background: rgba(0,0,0,.55); color: #fff;
      transform: translateY(100%); transition: transform .25s ease;
      backdrop-filter: blur(6px);
    }
    #ui.show { transform: translateY(0); }
    #ui h3 { margin: 0 0 6px; font-weight: 600; font-size: 16px; }
    #comments { max-height: 28vh; overflow: auto; margin: 8px 0; padding-right: 4px; }
    .comment { padding: 6px 8px; margin: 6px 0; background: rgba(255,255,255,.12); border-radius: 8px; }
    form { display: flex; gap: 8px; }
    input[type=text]{
      flex:1; padding:10px; border-radius:10px; border:1px solid #333; background:#111; color:#fff;
    }
    button { padding:10px 14px; border-radius:10px; border:0; background:#42a5f5; color:#000; font-weight:600; }
    #hint {
      position: fixed; top: 12px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,.55); color:#fff; padding:6px 10px; border-radius:999px; font-size:14px;
      opacity:.9;
    }
  </style>
</head>
<body>
  <div id="hint">Point your camera at the artwork to see comments</div>

  <!-- MindAR Scene -->
  <a-scene
      mindar-image="imageTargetSrc: ./targets (3).mind; filterMinCF:0.0001; filterBeta: 0.001;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true"
      renderer="colorManagement: true, physicallyCorrectLights: true">
    <a-assets></a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- Anchor bound to image target #0 -->
    <a-entity id="artAnchor" mindar-image-target="targetIndex: 0">
      <!-- A small floating marker to confirm tracking -->
      <a-entity position="0 0 0" rotation="0 0 0">
        <a-plane position="0 0 0" width="0.6" height="0.6" color="#ffffff" opacity="0.0"></a-plane>
      </a-entity>
    </a-entity>
  </a-scene>

  <!-- Comments UI -->
  <div id="ui">
    <h3>Comments</h3>
    <div id="comments"></div>
    <form id="commentForm" autocomplete="off">
      <input id="commentInput" type="text" placeholder="Add your thoughtâ€¦" />
      <button type="submit">Post</button>
    </form>
  </div>

  <script>
    // Simple per-artwork, per-device storage (no backend):
    const ART_ID = 'art-001'; // change per artwork if you have multiple
    const storeKey = (id)=>`comments:${id}`;

    function getComments(){
      try { return JSON.parse(localStorage.getItem(storeKey(ART_ID))||'[]'); }
      catch { return []; }
    }
    function setComments(list){
      localStorage.setItem(storeKey(ART_ID), JSON.stringify(list));
    }
    function render(){
      const wrap = document.getElementById('comments');
      const data = getComments();
      wrap.innerHTML = data.length
        ? data.map(c=>`<div class="comment">${escapeHtml(c.text)}<div style="opacity:.7;font-size:12px;margin-top:4px;">${new Date(c.ts).toLocaleString()}</div></div>`).join('')
        : `<div style="opacity:.8">Be the first to comment.</div>`;
    }
    function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

    // Form handling
    document.getElementById('commentForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const input = document.getElementById('commentInput');
      const text = input.value.trim();
      if(!text) return;
      const list = getComments();
      list.unshift({ text, ts: Date.now() });
      setComments(list);
      input.value = '';
      render();
    });

    // Show/hide UI when target is in view
    const ui = document.getElementById('ui');
    const hint = document.getElementById('hint');
    const anchor = document.getElementById('artAnchor');

    anchor.addEventListener('targetFound', ()=>{
      ui.classList.add('show');
      hint.style.display = 'none';
      render();
    });
    anchor.addEventListener('targetLost', ()=>{
      ui.classList.remove('show');
      hint.style.display = 'block';
    });
  </script>
</body>
</html>

