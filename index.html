<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>AR Artwork ‚Äî Screen-Locked Bubbles + Thread</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
<style>
  html,body{margin:0;height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto}
  .a-enter-vr,.a-enter-vr-button,.a-enter-ar,.a-enter-ar-button{display:none!important}

  /* hint + FAB */
  #hint{position:fixed;top:12px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.55);color:#fff;
        padding:6px 10px;border-radius:999px;z-index:7}
  #fab{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);width:68px;height:68px;border-radius:50%;
       background:radial-gradient(120% 120% at 30% 30%, #ffb2d9, #ffcf9a 55%, #b6c8ff);
       box-shadow:0 16px 40px rgba(255,160,200,.45), 0 6px 18px rgba(0,0,0,.35);
       border:1px solid rgba(255,255,255,.35); z-index:7; display:none}

  /* DOM bubbles (fixed on screen) */
  #bubbles{position:fixed;inset:0;pointer-events:none;z-index:6;display:none}
  .bubble{
    position:absolute; max-width:min(90vw,620px); color:#1a1a1a; pointer-events:auto;
    padding:14px 16px 38px; border-radius:22px; backdrop-filter:blur(10px);
    background:linear-gradient(180deg,#fff7f0 0%, #ffe9f6 100%); box-shadow:0 20px 50px rgba(0,0,0,.28);
    border:1px solid rgba(255,255,255,.6)
  }
  .bubble:after{ /* tail */
    content:""; position:absolute; left:50%; transform:translateX(-50%); bottom:-16px;
    width:34px; height:18px; background:linear-gradient(180deg,#fff7f0,#ffe9f6);
    clip-path:polygon(0 0,100% 0,50% 100%); filter:drop-shadow(0 8px 12px rgba(0,0,0,.15));
    border-bottom:1px solid rgba(255,255,255,.6); border-left:1px solid rgba(255,255,255,.6); border-right:1px solid rgba(255,255,255,.6);
    border-bottom-left-radius:6px;border-bottom-right-radius:6px;
  }
  .bubble h3{margin:0 0 6px; font-size:16px; font-weight:800; color:#2b232b}
  .bubble p{margin:0; line-height:1.25; color:#2b2b2b}
  .icons{position:absolute; left:14px; bottom:8px; display:flex; gap:14px; opacity:.9}
  .icon{width:22px; height:22px; display:inline-flex; align-items:center; justify-content:center;
        background:#00000010; border:1px solid #00000012; border-radius:999px; cursor:pointer; user-select:none}
  .icon.liked{background:#ff99c51f; border-color:#ff99c560}
  .icon span{font-size:14px}
  /* positions */
  #bubbleTop{top:10%; left:6%}
  #bubbleBottom{bottom:12%; left:50%; transform:translateX(-50%)}

  /* Composer sheet */
  #composer{position:fixed;inset:0;display:none;z-index:10;
    background:linear-gradient(140deg,#ffd7bd 15%,#ffc6e0 85%);
    padding:calc(env(safe-area-inset-top) + 20px) 16px calc(env(safe-area-inset-bottom) + 24px)}
  #composer.show{display:block}
  .comp{max-width:560px;margin:0 auto;height:100%;display:flex;flex-direction:column}
  .title{font-weight:800;font-size:22px;text-align:center;color:#2b232b;margin-bottom:12px}
  .pill{display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.86);border:1px solid rgba(0,0,0,.08);
        border-radius:18px;padding:10px 12px}
  .pill input{flex:1;border:0;outline:none;background:transparent;font-size:16px;color:#2b232b}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin:12px auto 0;max-width:560px}
  .chip{padding:6px 10px;border-radius:999px;background:rgba(0,0,0,.08);border:1px solid rgba(0,0,0,.06);color:#503d49;cursor:pointer}
  .actions{margin-top:auto;display:flex;gap:10px;justify-content:center}
  .btn{padding:12px 16px;border-radius:14px;border:0;font-weight:700;cursor:pointer}
  .btn.primary{background:#2b232b;color:#fff}
  .btn.secondary{background:#ffffffcc;color:#2b232b}

  /* Thread overlay (stacked comments) */
  #thread{position:fixed;left:0;right:0;bottom:96px;z-index:8;display:none;pointer-events:auto}
  .threadWrap{max-width:680px;margin:0 auto;padding:0 12px;display:flex;flex-direction:column;gap:12px}
  .tCard{
    border-radius:28px;
    background:linear-gradient(180deg,#eaa38c 0%, #c17567 100%);
    color:#fff; padding:14px 18px; box-shadow:0 22px 50px rgba(0,0,0,.35);
    border:1px solid #ffffff33; display:flex; align-items:center; gap:12px
  }
  .tMeta{min-width:140px;font-weight:700}
  .tMeta small{display:block;opacity:.85;font-weight:600}
  .tText{flex:1}
  .tLike{margin-left:auto;background:#ffffff22;border:1px solid #ffffff44;border-radius:12px;padding:8px 10px;cursor:pointer}
  .tBar{display:flex;justify-content:flex-end;gap:10px;margin:6px auto 0;max-width:680px;padding:0 12px}
  .tBtn{background:#111a22;color:#fff;border:1px solid #2a3342;border-radius:12px;padding:8px 12px;cursor:pointer}
</style>
</head>
<body>

<div id="hint">Point your camera at the artwork</div>

<!-- Fixed bubbles -->
<div id="bubbles">
  <!-- Top (artist) -->
  <div id="bubbleTop" class="bubble">
    <h3>Zen ‚Äì the artist</h3>
    <p>‚ÄúThis piece explores the interplay of displacement, everyday objects and nostalgic wonder.‚Äù</p>
    <div class="icons">
      <div id="likeTop" class="icon" title="Like"><span>‚ù§Ô∏è</span></div>
      <div class="icon" title="Comment" id="cTop"><span>üí¨</span></div>
      <div class="icon" title="Share" id="sTop"><span>‚ÜóÔ∏é</span></div>
    </div>
  </div>
  <!-- Bottom (curator / latest visitor) -->
  <div id="bubbleBottom" class="bubble">
    <h3>Curator‚Äôs Note</h3>
    <p id="bottomText">‚ÄúA quiet yet defiant work that turns ordinary retail bags into a field for memory, resilience and becoming.‚Äù</p>
    <div class="icons">
      <div id="likeBottom" class="icon" title="Like"><span>‚ù§Ô∏è</span></div>
      <div class="icon" title="Comment" id="cBottom"><span>üí¨</span></div>
      <div class="icon" title="Share" id="sBottom"><span>‚ÜóÔ∏é</span></div>
    </div>
  </div>
</div>

<!-- floating action button to open composer -->
<div id="fab" aria-label="Share your thoughts"></div>

<!-- Thread overlay (stacked comments) -->
<div id="thread">
  <div class="threadWrap" id="threadList"></div>
  <div class="tBar">
    <button id="threadNext" class="tBtn">Next ‚Üª</button>
    <button id="threadClose" class="tBtn">Close ‚úï</button>
  </div>
</div>

<!-- Composer -->
<div id="composer" role="dialog" aria-modal="true">
  <div class="comp">
    <div class="title">What‚Äôs on your mind?</div>
    <div class="pill">
      <input id="compInput" placeholder="Add your thought‚Ä¶" maxlength="300"/>
      <button id="sendBtn" class="btn primary">Post</button>
    </div>
    <div class="chips" id="chipbar">
      <div class="chip">Happy</div><div class="chip">Grateful</div><div class="chip">Curious</div>
      <div class="chip">Calm</div><div class="chip">Excited</div><div class="chip">Inspired</div>
    </div>
    <div class="actions">
      <button id="closeComp" class="btn secondary">Cancel</button>
    </div>
  </div>
</div>

<!-- AR scene -->
<a-scene id="scene"
         mindar-image="imageTargetSrc: ./targets%20(7).mind"
         renderer="colorManagement:true, physicallyCorrectLights:false"
         vr-mode-ui="enabled:false"
         device-orientation-permission-ui="enabled:true"
         embedded>
  <a-camera look-controls="enabled:false"></a-camera>
  <a-entity id="anchor" mindar-image-target="targetIndex: 0"></a-entity>
</a-scene>

<script>
  /* ====== CONFIG ====== */
  const TARGET_PATH = "./targets%20(7).mind"; // change if your .mind path differs
  document.getElementById("scene").setAttribute("mindar-image", `imageTargetSrc: ${TARGET_PATH}`);

  /* ====== Local state (bottom bubble shows latest visitor) ====== */
  const ART_ID = "art1";
  const k = (n)=>`webar:${ART_ID}:${n}`;
  const load = (n, f)=>{ try{ return JSON.parse(localStorage.getItem(k(n))||JSON.stringify(f)); }catch{ return f; } };
  const save = (n, v)=> localStorage.setItem(k(n), JSON.stringify(v));
  let latest = load("latestComment", null);
  const bottomText = document.getElementById("bottomText");
  if (latest) bottomText.textContent = latest;

  /* ====== Show fixed bubbles once target seen ====== */
  const bubbles = document.getElementById('bubbles');
  const fab = document.getElementById('fab');
  const hint = document.getElementById('hint');
  const anchor = document.getElementById('anchor');
  let shown = false;
  anchor.addEventListener('targetFound', ()=>{
    if (shown) return;
    shown = true;
    hint.style.display = 'none';
    bubbles.style.display = 'block';
    fab.style.display = 'block';
  });
  anchor.addEventListener('targetLost', ()=>{ /* keep bubbles shown */ });

  /* ====== Likes & share ====== */
  function toggleLike(btnId, storeKey){
    const el = document.getElementById(btnId);
    const liked = load(storeKey, false);
    if (liked) el.classList.add('liked'); else el.classList.remove('liked');
    el.addEventListener('click', ()=>{
      const now = !load(storeKey, false);
      save(storeKey, now);
      if (now) el.classList.add('liked'); else el.classList.remove('liked');
    });
  }
  toggleLike('likeTop', 'likedTop');
  toggleLike('likeBottom', 'likedBottom');

  function sharePage(){ const url = location.href;
    if (navigator.share) navigator.share({title:'AR Artwork', url}).catch(()=>{});
    else navigator.clipboard.writeText(url).then(()=>alert('Link copied'));
  }
  document.getElementById('sTop').onclick = sharePage;
  document.getElementById('sBottom').onclick = sharePage;

  /* ====== Composer ====== */
  const composer = document.getElementById('composer');
  const compInput = document.getElementById('compInput');
  const sendBtn = document.getElementById('sendBtn');
  const closeComp = document.getElementById('closeComp');
  const chipbar = document.getElementById('chipbar');
  function openComposer(){ composer.classList.add('show'); compInput.focus(); }
  function closeComposer(){ composer.classList.remove('show'); }
  fab.onclick = openComposer;
  document.getElementById('cTop').onclick = toggleThread;     // comment icon opens thread
  document.getElementById('cBottom').onclick = toggleThread;  // comment icon opens thread
  closeComp.onclick = closeComposer;
  chipbar.onclick = (e)=>{ if(e.target.classList.contains('chip')) {
    const t = e.target.textContent.trim();
    compInput.value = compInput.value ? (compInput.value + ' ' + t) : t;
    compInput.focus();
  }};
  function post(){
    const t = (compInput.value||"").trim(); if(!t) return;
    compInput.value = "";
    latest = t; save("latestComment", t);
    bottomText.textContent = t;
    closeComposer();
  }
  sendBtn.onclick = post;

  /* ====== Thread overlay (HARD-CODED COMMENTS + loop) ====== */
  const THREAD = [
    { user:"lucyjean333", age:"11h", text:"Love this!!", likes:5 },
    { user:"talk_tour",   age:"2d",  text:"Love your content!", likes:8 },
    { user:"gallery_go",  age:"3d",  text:"The composition is beautiful.", likes:2 },
    { user:"art_student", age:"5d",  text:"This spoke to me today.", likes:4 },
    { user:"familia",     age:"1w",  text:"Reminds me of home ‚ù§Ô∏è", likes:6 },
    { user:"local_guide", age:"2w",  text:"Great curation and lighting.", likes:1 },
  ];
  const thread = document.getElementById('thread');
  const threadList = document.getElementById('threadList');
  const threadNext = document.getElementById('threadNext');
  const threadClose = document.getElementById('threadClose');
  let tIndex = 0; // start index for the current page of 3

  function renderThread(){
    threadList.innerHTML = "";
    for (let i=0;i<3;i++){
      const item = THREAD[(tIndex + i) % THREAD.length];
      const card = document.createElement('div');
      card.className = "tCard";
      card.innerHTML = `
        <div class="tMeta">@${item.user}<small>${item.age}</small></div>
        <div class="tText">${escapeHtml(item.text)}</div>
        <div class="tLike" data-i="${(tIndex+i)%THREAD.length}">üëç ${item.likes}</div>`;
      threadList.appendChild(card);
    }
    // like buttons (local only)
    threadList.querySelectorAll('.tLike').forEach(btn=>{
      btn.onclick = (e)=>{
        const i = Number(e.currentTarget.dataset.i);
        THREAD[i].likes++;
        renderThread();
      };
    });
  }
  function openThread(){ renderThread(); thread.style.display='block'; }
  function closeThread(){ thread.style.display='none'; }
  function toggleThread(){
    // If hidden ‚Üí show first page; if visible ‚Üí hide (as requested)
    if (thread.style.display !== 'block'){ tIndex = 0; openThread(); }
    else { closeThread(); }
  }
  threadNext.onclick = ()=>{ tIndex = (tIndex + 3) % THREAD.length; renderThread(); };
  threadClose.onclick = closeThread;

  /* ===== Helpers ===== */
  function escapeHtml(s){return (s||"").replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));}
</script>
</body>
</html>
